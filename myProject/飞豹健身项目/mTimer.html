<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0,  user-scalable=0" name="viewport" />
    <script type='text/javascript' src='http://www.fitboxchina.com/library/jquery-2.1.4.js'></script>
    <link rel="stylesheet" type="text/css" href="m/m.css" />
    <link rel="stylesheet" type="text/css" href="myCss.css" />
    <script src="m.js"></script>
    <title>Title</title>
</head>
<body>
<div class="wrap">
    <div class="wrap-box timer-box">
        <div class="title"><h3><i class="timer-icon">&#xe60b;</i> 健身计时</h3></div>
        <div class="content">
            <span id="timerContent">00:00:00:00</span>
        </div>
    </div>
    <div class="xqdiv4 wrap-box" style="margin-bottom: 2.5%;" id="openDoorTemplate">
        <div class="title"><h3 id="title">点击开门，确定健身</h3></div>
        <div class="content" id="title-content">
            <img id="enterDoor" src='http://www.yumukeji.com/project/feibaoTest/img/WebsiteImg/Dpo56786225SD.jpg' style='display: block;margin: auto;width: 40%;' id='gr-qrcode'>        </div>
    </div>
    <div class="xqdiv4 wrap-box" style="margin-bottom: 2.5%;" id="closeDoorTemplate">
        <div class="title"><h3 id="title">点击开门，结束健身</h3></div>
        <div class="content" id="title-content">
            <img id="outDoor" src='http://www.yumukeji.com/project/feibaoTest/img/WebsiteImg/Dpo56786225SD.jpg' style='display: block;margin: auto;width: 40%;' id='gr-qrcode'>        </div>
    </div>
</div>
<!--扫码开门弹出层开始 现在门禁不用扫二维码-->
<!--<div style='position:fixed; display:none;text-align: center; background:#fff;left: 0;top: 0;width: 100%;z-index: 200005;height: 100%'  id='qd-mask'>
    <div class='weui_msg' id="qr-code">
        <div class='weui_icon_area'>
            <div style='width:85%;margin:5px auto' id="qrcode"><img src="qr-code.jpg" alt=""></div>
        </div>
        <div class='weui_text_area'>
            <p class='weui_msg_desc'>把二维码对准机器摄像头，识别即可开门。</p>
        </div>
        <div class='weui_opr_area'>
            <p class='weui_btn_area'>
                <a href="javascript:;" id="close-qr" class="weui_btn weui_btn_primary" style="color:#fff;">关闭</a>
            </p>
        </div>
    </div>
</div>-->
<!--扫码开门弹出层结束-->
</body>
<script>
    window.onload = function() {
        /**
         * 健身计时
         * @author He Hui
         * */
        var enterDoor = document.getElementById('enterDoor');
        var outDoor = document.getElementById('outDoor');
        var timer = null;
        var days = null;
        var hours = null;
        var minutes = null;
        var seconds = null;
        enterDoor.onclick = function() {
            var date = new Date();
            var beginTime = date.getTime();
            setCookie('beginTime', beginTime);
        }

        totalTimer();
        timer = setInterval(function() {
            totalTimer();
        }, 1e3)
        outDoor.onclick = function() {
            /*clearInterval(timer);*/
            var totalTime = parseInt(days) * 1440 + parseInt(hours) * 60 + parseInt(minutes);
            var price = 0.3; // 调用后台一分钟多少钱
            var money = accMul(totalTime,price);
            alert('你一共健身'+totalTime+'分钟,你应付'+money+'元');
        }

        /**
         * 写cookies
         * @param name 名字
         * @param value 值
         * @author He Hui
         * */
        function setCookie(name,value)
        {
            var Days = 30;
            var exp = new Date();
            exp.setTime(exp.getTime() + Days*24*60*60*1000);
            document.cookie = name + "="+ escape (value) + ";expires=" + exp.toGMTString();
        }
        /**
         * 读取cookies
         * @param name 名字
         * @author He Hui
         * */
        function getCookie(name)
        {
            var arr,reg=new RegExp("(^| )"+name+"=([^;]*)(;|$)");
            if(arr=document.cookie.match(reg)) return unescape(arr[2]);
            else return null;
        }
        /**
         * 删除cookies
         * @param name 名字
         * @author He Hui
         * */
        function delCookie(name)
        {
            var exp = new Date();
            exp.setTime(exp.getTime() - 1);
            var cval=getCookie(name);
            if(cval!=null) document.cookie= name + "="+cval+";expires="+exp.toGMTString();
        }
        /**
         * 计算时间
         * @author He Hui
         * */
        function totalTimer() {
            var date = new Date();
            var currentTime = date.getTime();
            var differ = currentTime - getCookie('beginTime');
            //计算出相差天数
            days = Math.floor(differ/(24*3600*1000));
            //计算出小时数
            var remainHours = differ%(24*3600*1000);    //计算天数后剩余的毫秒数
            hours = Math.floor(remainHours/(3600*1000));
            //计算相差分钟数
            var remainMinutes = remainHours%(3600*1000);        //计算小时数后剩余的毫秒数
            minutes = Math.floor(remainMinutes/(60*1000));
            //计算相差秒数
            var leaveSeconds = remainMinutes%(60*1000);      //计算分钟数后剩余的毫秒数
            seconds = Math.round(leaveSeconds/1000);
            if (days.toString().length < 2) days = '0' +　days;
            if (hours.toString().length < 2) hours = '0' +　hours;
            if (minutes.toString().length < 2) minutes = '0' + minutes;
            if (seconds.toString().length < 2) seconds = '0' + seconds;
            var timerContent = document.getElementById('timerContent');
            timerContent.innerHTML = days+":"+hours+":"+minutes+":"+seconds;
        }
        /**
         * 乘法函数
         * @param arg1 参数1
         * @param arg2 参数2
         * @returns {number} 整数
         * @author He Hui
         */
        function accMul(arg1,arg2) {
            var m=0,s1=arg1.toString(),s2=arg2.toString();
            try{m+=s1.split(".")[1].length}catch(e){}
            try{m+=s2.split(".")[1].length}catch(e){}
            return  Number(s1.replace(".",""))*Number(s2.replace(".",""))/Math.pow(10,m)
        }
    }
</script>
</html>