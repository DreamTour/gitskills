<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>

        * {
            margin: 0;
            padding: 0;
        }

        #container {
            position: relative;
        }

        .box {
            padding:5px;
            float: left;
        }

        .border_img {
            border: 1px solid #ccc;
            border-radius:5px;
            box-shadow:0 0 5px #ccc;
            padding: 5px;
        }

        .border_img img {
            width: 190px;
            height:auto;
        }

    </style>
</head>
<body>

<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>瀑布流</title>
    <link href="css/pubuliu.css" rel="stylesheet" type="text/css" />
    <script src="js/pubuliu.js"></script>
</head>
<body>
<div id="container">
    <div class="box">
        <div class="border_img">
            <img src="images/1.jpg" />
        </div>
    </div>
    <div class="box">
        <div class="border_img">
            <img src="images/2.jpg" />
        </div>
    </div>
    <div class="box">
        <div class="border_img">
            <img src="images/3.jpg" />
        </div>
    </div>
    <div class="box">
        <div class="border_img">
            <img src="images/4.jpg" />
        </div>
    </div>
    <div class="box">
        <div class="border_img">
            <img src="images/5.jpg" />
        </div>
    </div>
    <div class="box">
        <div class="border_img">
            <img src="images/6.jpg" />
        </div>
    </div>
    <div class="box">
        <div class="border_img">
            <img src="images/7.jpg" />
        </div>
    </div>
    <div class="box">
        <div class="border_img">
            <img src="images/8.jpg" />
        </div>
    </div>
    <div class="box">
        <div class="border_img">
            <img src="images/9.jpg" />
        </div>
    </div>
    <div class="box">
        <div class="border_img">
            <img src="images/1.jpg" />
        </div>
    </div>
    <div class="box">
        <div class="border_img">
            <img src="images/1.jpg" />
        </div>
    </div>
    <div class="box">
        <div class="border_img">
            <img src="images/2.jpg" />
        </div>
    </div>
    <div class="box">
        <div class="border_img">
            <img src="images/3.jpg" />
        </div>
    </div>
    <div class="box">
        <div class="border_img">
            <img src="images/4.jpg" />
        </div>
    </div>
    <div class="box">
        <div class="border_img">
            <img src="images/5.jpg" />
        </div>
    </div>
    <div class="box">
        <div class="border_img">
            <img src="images/6.jpg" />
        </div>
    </div>
    <div class="box">
        <div class="border_img">
            <img src="images/7.jpg" />
        </div>
    </div>
    <div class="box">
        <div class="border_img">
            <img src="images/8.jpg" />
        </div>
    </div>
    <div class="box">
        <div class="border_img">
            <img src="images/9.jpg" />
        </div>
    </div>
    <div class="box">
        <div class="border_img">
            <img src="images/1.jpg" />
        </div>
    </div>
    <div class="box">
        <div class="border_img">
            <img src="images/1.jpg" />
        </div>
    </div>
    <div class="box">
        <div class="border_img">
            <img src="images/2.jpg" />
        </div>
    </div>
    <div class="box">
        <div class="border_img">
            <img src="images/3.jpg" />
        </div>
    </div>
    <div class="box">
        <div class="border_img">
            <img src="images/4.jpg" />
        </div>
    </div>
    <div class="box">
        <div class="border_img">
            <img src="images/5.jpg" />
        </div>
    </div>
    <div class="box">
        <div class="border_img">
            <img src="images/6.jpg" />
        </div>
    </div>
    <div class="box">
        <div class="border_img">
            <img src="images/7.jpg" />
        </div>
    </div>
    <div class="box">
        <div class="border_img">
            <img src="images/8.jpg" />
        </div>
    </div>
    <div class="box">
        <div class="border_img">
            <img src="images/9.jpg" />
        </div>
    </div>
    <div class="box">
        <div class="border_img">
            <img src="images/1.jpg" />
        </div>
    </div>
    <div class="box">
        <div class="border_img">
            <img src="images/1.jpg" />
        </div>
    </div>
    <div class="box">
        <div class="border_img">
            <img src="images/2.jpg" />
        </div>
    </div>
    <div class="box">
        <div class="border_img">
            <img src="images/3.jpg" />
        </div>
    </div>
    <div class="box">
        <div class="border_img">
            <img src="images/4.jpg" />
        </div>
    </div>
    <div class="box">
        <div class="border_img">
            <img src="images/5.jpg" />
        </div>
    </div>
    <div class="box">
        <div class="border_img">
            <img src="images/6.jpg" />
        </div>
    </div>
    <div class="box">
        <div class="border_img">
            <img src="images/7.jpg" />
        </div>
    </div>
    <div class="box">
        <div class="border_img">
            <img src="images/8.jpg" />
        </div>
    </div>
    <div class="box">
        <div class="border_img">
            <img src="images/9.jpg" />
        </div>
    </div>
    <div class="box">
        <div class="border_img">
            <img src="images/1.jpg" />
        </div>
    </div>
    <div class="box">
        <div class="border_img">
            <img src="images/1.jpg" />
        </div>
    </div>
    <div class="box">
        <div class="border_img">
            <img src="images/2.jpg" />
        </div>
    </div>
    <div class="box">
        <div class="border_img">
            <img src="images/3.jpg" />
        </div>
    </div>
    <div class="box">
        <div class="border_img">
            <img src="images/4.jpg" />
        </div>
    </div>
</div>
<div>dsfasdsdsdsdsdsdsdsdsdsdsdsdsdsdsdsdsdsdsdsdsdsdsdsd</div>
</body>
</html>

</body>
<script>
    window.onload = function () {
        onloadImages("container", "box");
    }
    window.onscroll = function () {
        if (dongtaitianjia("container", "box")) {
            var imgData = { "data": [{ "src": "1.jpg" }, { "src": "2.jpg" }, { "src": "3.jpg" }, { "src": "4.jpg" }, { "src": "5.jpg" }, { "src": "6.jpg" }, { "src": "7.jpg" }, { "src": "8.jpg" }, { "src": "9.jpg" }] }
            var containerDiv = document.getElementById("container");//获取id=“container”的div
            for (var i = 0; i < imgData.data.length; i++) {
                var boxDiv = document.createElement("div");//动态创建div标签
                boxDiv.className = "box";//动态设置div的class="box"
                containerDiv.appendChild(boxDiv);//动态添加containerDiv子节点
                var borderImgDiv = document.createElement("div");//动态创建div标签
                borderImgDiv.className = "border_img";//动态设置div的class="border_img"
                boxDiv.appendChild(borderImgDiv);//动态添加boxDiv子节点
                var boxImg = document.createElement("img");//动态创建img标签
                boxImg.src = "images/" + imgData.data[i].src;
                borderImgDiv.appendChild(boxImg);//动态添加boxDiv子节点
            }
            onloadImages("container", "box");
        }
    }
    //判断是否要加载内容
    function dongtaitianjia(parent, box) {
        var containerChilder = document.getElementById(parent);//获取container下的集合
        var boxList = containerChilder.getElementsByClassName(box);//获取所有的.box集合
        var lastBoxOffsetTop = boxList[boxList.length - 1].offsetTop;//最后一个.box集合元素的offsetTop
        var pingmuHeight = document.documentElement.clientHeight || document.body.clientHeight;//内容区的高度
        var scrollHeight = document.documentElement.scrollTop || document.body.scrollTop;//滚动的高度
        if (lastBoxOffsetTop < pingmuHeight + scrollHeight) {
            return true;
        }
        else {
            return false;
        }
    }
    function onloadImages(parent, box) {
        var containerChilder = document.getElementById(parent);//获取container下的集合
        var boxList = containerChilder.getElementsByClassName(box);//获取所有的.box集合
        var num = Math.floor(document.documentElement.clientWidth / boxList[0].offsetWidth);//得到一行能放几张图片
        containerChilder.style.cssText = "width:" + num * boxList[0].offsetWidth + "px;margin:0 auto;"//设置宽度，居中
        var boxHeightArray = [];//第一行.box集合高度的集合
        for (var i = 0; i < boxList.length; i++) {
            if (i < num) {
                boxHeightArray.push(boxList[i].offsetHeight);//第一行.box的高度集合
            }
            else {
                var minArrayHeight = Math.min.apply(null, boxHeightArray);//获取集合中的最小值，也就是高度最小的那个
                var minHeightIndex = getMinHeightArray(boxHeightArray, minArrayHeight);//获取高度最小的那个.box集合位置
                boxList[i].style.position = "absolute";//设置绝对定位
                boxList[i].style.left = boxList[minHeightIndex].offsetLeft + "px";
                boxList[i].style.top = minArrayHeight + "px";
                boxHeightArray[minHeightIndex] = boxHeightArray[minHeightIndex] + boxList[i].offsetHeight;//把集合中最矮的加上放在下面的元素的高度，避免所有的元素都挤在一起
            }
        }
    }
    //获取高度最小的那个.box集合位置
    function getMinHeightArray(array, minHeight) {
        for (var i = 0; i < array.length; i++) {
            if (array[i] == minHeight) {
                return i;
            }
        }
    }
</script>
</html>